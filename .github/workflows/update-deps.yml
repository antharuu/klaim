name: Update Dependencies

on:
    schedule:
        -   cron: '0 0 * * 1'  # Tous les lundis √† minuit
    workflow_dispatch:      # Permet de lancer manuellement

jobs:
    update-deps:
        runs-on: ubuntu-latest
        steps:
            -   uses: actions/checkout@v4
                with:
                    fetch-depth: 0  # Important pour release-it

            -   name: Setup Node.js
                uses: actions/setup-node@v4
                with:
                    node-version: '20'
                    cache: 'npm'

            -   name: Install dependencies
                run: npm install

            -   name: Update dependencies
                run: |
                    # Mise √† jour des d√©pendances de d√©veloppement
                    npx npm-check-updates '/^@.*/' -u
                    npx npm-check-updates -u
                    npm install

            -   name: Run tests
                run: npm run test

            -   name: Run lint
                run: npm run lint

            -   name: Build
                run: npm run build

            -   name: Create Pull Request
                uses: peter-evans/create-pull-request@v6
                with:
                    commit-message: "chore: update dependencies"
                    title: "üì¶ Update dependencies"
                    body: |
                        # Mise √† jour automatique des d√©pendances
                        
                        ‚úÖ Tests pass√©s
                        ‚úÖ Build r√©ussi
                        ‚úÖ Lint valid√©
                        
                        ## Changements
                        Les d√©pendances suivantes ont √©t√© mises √† jour vers leurs derni√®res versions :
                        - Toutes les d√©pendances de d√©veloppement (@types/*, eslint, etc.)
                        
                        Veuillez v√©rifier les changements avant de merger.
                    branch: "chore/update-dependencies"
                    labels: |
                        dependencies
                        automated pr
                    delete-branch: true

            -   name: Check PR Status
                if: success()
                run: |
                    echo "‚úÖ Pull Request cr√©√©e avec succ√®s"
                    echo "Vous pouvez maintenant examiner les changements et merger si tout est en ordre"